# wgs2tree
This is a nextflow implementation of a workflow for the rapid generation of consensus phylogenomic trees from whole genome sequence data.

The workflow is as follows:

Inputs are whole genome assemblies, each sample can include multiple assemblies (ie, hap1 and 2)

1. For each assembly, single-copy orthologues are identified with Compleasm or Busco
2. For samples consisting of more than one assembly, the best non-redundant set of Busco orthologues is retrieved with Buscomp
3. Samples are grouped by BUSCO gene
4. For each BUSCO gene, a multiple sequence alignment is generated with MAFFT
5. A phylogenetic tree is generated for each alignment with IQTree2
6. A consensus phylogenomic tree is generated by coelescense with ASTRAL, or by concatenation from an alignment supermatrix with IQTree2
7. Gene concordance factors are calculated for the consensus tree with IQTree2

## Config
The nextflow config file should be modified to specify relevant parameters, using the provided 'template.config'. Various specifications can be made within the 'params' scope. 

**1. samplePaths:**  
This parameter is used to specify assembly inputs. A sample ID is mapped to the paths of one or more assemblies. 

**2. sampleBuscoPaths:**  
This parameter is used to specify busco inputs and map these to samples. When running the workflow, any provided busco run directories will be paired to a respective assembly in samplePaths. If an assembly does not have a corresponding busco run as input, compleasm will be executed for the assembly. In order for pairing of assembly and busco inputs, the busco run directory must have the same base-name as the corresponding assembly fasta file, but with a 'run_' prefix (see below).
```
Assembly = /path/to/assembly/sample1.fasta
Busco = /path/to/busco/run_sample1/
```

**3. busco_lineage:**  
This will be used in any busco/compleasm runs performed by the workflow.

**4. lineage_folder:**  
Use this folder to store/download lineages for busco/compleasm. 

**4. busco_out:**  
Specify a directory to which busco outputs should be saved.

**5. buscomp_out:**  
Specify a directory to which buscomp outputs should be saved.

**6. parse_genes_out:**  
Specify a directory to which parsed busco genes should be saved.

**7. mafft_out:**  
Specify a directory to which aligned busco genes should be saved.

**8. iqtree_out:**  
Specify a directory to which gene trees should be saved

**9. astral_out:**  
Specify a directory to which consensus tree should be saved